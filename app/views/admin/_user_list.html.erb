<div>
  <legend>Invite User</legend>
  <p class="configured-banner">
    Send and invitation to someone to register for the application.
  </p>
  <%= bootstrap_form_for(User.new , url: admin_users_send_invitation_path, html: { method: :post, 'data-parsley-validate': '' }) do |f| %>
  <div class="panel-body">
    <table><tr><td>
    <%= f.email_field :email, autocapitalize: 'off', autocorrect: 'off', autofocus: true,
    'data-parsley-required': '',
    'data-parsley-type':"email",
    'data-parsley-trigger': 'blur' %>
  </td><td>
     <button class="btn btn-default" >Invite User</button>
   </td></tr></table>
  </div>
  <% end %>
</div>
<table class="table">
  <thead>
    <tr>
      <th>Email</th>
      <th>Role</th>
      <th>Approved</th>
      <th>Assignments</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% User.excludes(id: current_user.id).order_by(email:  1).each do |user|
    role = user.roles.where({resource_id: nil}).first
    assignments = user.roles.where({resource_id: {"$ne"=> nil}})
    invited_and_not_accepted = user.invitation_sent_at? && !user.invitation_accepted?
    %>
    <tr>
      <td><%= user.email %>
        <% if invited_and_not_accepted %>
         <p>
          <strong>
            Invitation sent
          </strong>
        </p>
        <% end %>
      </td>
      <td><%= role.name if role %></td>
      <td><a href="<%= toggle_approved_admin_user_path(user) %>" data-turbolinks-action="replace"><%= user.approved %></a></td>
      <td>
        <table class"table">
          <% assignments.each do |ass|
            if ass.resource
          %>
          <tr><td class="col-sm-3"><%= ass.name %></td><td class="col-sm-9"><%= ass.resource.name %></td></tr>
        <%  end
          end
       %>
        </table>
      </td>
      <td><a class="btn btn-default" href="<%= edit_admin_user_path(user) %>"><i class="fa fa-fw fa-wrench" aria-hidden="true"></i>Edit User </a></td>
    </tr>
    <% end %>
  </tbody>

</table>
